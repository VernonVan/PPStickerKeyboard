# PPStickerKeyboard
æœ€è¿‘åœ¨å…¬å¸åšäº†ä¸ªè¡¨æƒ…é”®ç›˜çš„éœ€æ±‚ï¼Œè¿™ä¸ªéœ€æ±‚çš„æŠ€æœ¯éš¾åº¦ä¸ä¼šå¾ˆå¤§ï¼Œæ¯”è¾ƒåå‘ä¸šåŠ¡ã€‚ä½†æ˜¯è¦æŠŠç”¨æˆ·ä½“éªŒåšçš„å¥½ä¹Ÿæ˜¯ä¸å®¹æ˜“çš„ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚è¯ä¸å¤šè¯´ï¼Œä¸‹é¢å¼€å§‹æ­£æ–‡(æ³¨ï¼šæœ¬æ–‡å¯¹åº”çš„Demoæ”¾åœ¨Githubä¸Šï¼š[https://github.com/VernonVan/PPStickerKeyboard](https://github.com/VernonVan/PPStickerKeyboard))ã€‚

## å¸‚é¢ä¸Šçš„è¡¨æƒ…é”®ç›˜çš„åˆ†æ

é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å¸‚é¢ä¸Šä¸»è¦çš„å‡ ä¸ªAPPä¸Šçš„è¡¨æƒ…é”®ç›˜ï¼Œå¹³æ—¶ä½¿ç”¨çš„æ—¶å€™ä¸ä¼šå»å…³æ³¨ç»†èŠ‚ï¼Œè¿™æ¬¡ç‰¹æ„å»ä½¿ç”¨äº†è¡¨æƒ…é”®ç›˜ï¼Œå‘ç°å„ä¸ªAPPçš„ä½“éªŒè¿˜æ˜¯æœ‰ä¼˜æœ‰åŠ£çš„ã€‚

é¦–å…ˆæ˜¯QQå’Œå¾®ä¿¡ï¼Œè¿™ä¸¤è€…å·®ä¸å¤šï¼Œåˆ‡æ¢åˆ°è¡¨æƒ…é”®ç›˜çš„æ—¶å€™éƒ½æ˜¯æ²¡æœ‰å…‰æ ‡çš„ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒæ˜¯éå¸¸ä¸å¥½çš„ï¼Œæ²¡æœ‰åŠæ³•åœ¨è¾“å…¥è¡¨æƒ…çš„æ—¶å€™æ¡†é€‰åŒºåŸŸï¼Œä¹Ÿä¸èƒ½æ‹–åŠ¨å…‰æ ‡è¿›è¡Œç‰¹å®šä½ç½®çš„å¤åˆ¶é»è´´åˆ é™¤ç­‰æ“ä½œï¼Œå¾®ä¿¡ç”šè‡³åœ¨è¾“å…¥æ¡†é‡Œæ˜¾ç¤ºçš„éƒ½ä¸æ˜¯ç‚¹å‡»çš„è¡¨æƒ…å›¾ç‰‡ï¼Œè€Œæ˜¯æ–‡å­—æè¿°ã€‚

![å¾®ä¿¡QQè¡¨æƒ…é”®ç›˜.JPG](http://upload-images.jianshu.io/upload_images/698554-2c59f42aa0dd0dd1.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¾®åšå›½é™…ç‰ˆï¼Œå›½é™…ç‰ˆè°ƒèµ·è¡¨æƒ…é”®ç›˜æ—¶æ˜¯æœ‰å…‰æ ‡çš„ï¼Œæ˜¯ä¸€ä¸ª"çœŸæ­£çš„"é”®ç›˜ï¼Œä½†æ˜¯æƒ³è¦æ‹–æ‹½å…‰æ ‡çš„æ—¶å€™ï¼Œå¾ˆå¤§æ¦‚ç‡ä¸Šä¼šè§¦å‘åˆ°ä¿å­˜å›¾ç‰‡çš„è¡Œä¸ºï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œå¯¼è‡´æ ¹æœ¬æ²¡åŠæ³•æ‹–åŠ¨å…‰æ ‡ã€‚
![å¾®åšå›½é™…ç‰ˆè¯¯è§¦.JPG](http://upload-images.jianshu.io/upload_images/698554-5f667795a7778a6e.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

åŒæ—¶å¾®åšå›½é™…ç‰ˆè¾“å…¥æ¡†è¡¨æƒ…é»è´´åçš„å…‰æ ‡å®šä½æ˜¯é”™è¯¯çš„ï¼Œå¦‚ä¸‹å›¾ï¼Œå¼€å§‹æ—¶å…‰æ ‡æ˜¯åœ¨ç¬¬4ä¸ªè¡¨æƒ…åé¢ï¼Œç„¶åå¤åˆ¶ç‹—å¤´+å®³ç¾ä¸¤ä¸ªè¡¨æƒ…é»è´´åˆ°å…‰æ ‡åï¼Œå…‰æ ‡è¿˜æ˜¯åœ¨ç¬¬4ä¸ªè¡¨æƒ…åï¼ŒåŒæ—¶é»è´´çš„è¡¨æƒ…å‰åéƒ½è«åå¤šäº†ç©ºæ ¼ã€‚
![å¾®åšå›½é™…ç‰ˆé»è´´.JPG](http://upload-images.jianshu.io/upload_images/698554-d4cddecefc22cfc9.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æœ€åæ˜¯å¾®åšï¼Œå¾®åšå®¢æˆ·ç«¯çš„è¡¨æƒ…é”®ç›˜çš„ä½“éªŒæ˜¯éå¸¸å¥½çš„ï¼Œä¸Šé¢è¯´åˆ°çš„é—®é¢˜éƒ½ä¸å­˜åœ¨ï¼Œè€Œä¸”è¡¨æƒ…é”®ç›˜çš„åˆ é™¤æŒ‰é’®è¿˜èƒ½é•¿æŒ‰åˆ é™¤è¾“å…¥æ¡†çš„å†…å®¹ã€‚
![å¾®åšè¡¨æƒ…é”®ç›˜.jpg](http://upload-images.jianshu.io/upload_images/698554-63023d1dfcce132b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## è¡¨æƒ…é”®ç›˜çš„å®ç°

#### å®ç°æ•ˆæœ

ä¸»è¦å®ç°äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½

- èƒ½è¾“å…¥è¡¨æƒ…ï¼Œæœ‰å…‰æ ‡ï¼Œæ”¯æŒå¤åˆ¶é»è´´åˆ é™¤è¡¨æƒ…ç­‰
- é•¿æŒ‰é¢„è§ˆè¡¨æƒ…
- åˆ é™¤è¡¨æƒ…ã€é•¿æŒ‰è¿ç»­åˆ é™¤è¡¨æƒ…
- é€‚é… iPhone X
  ![æ¼”ç¤º.GIF](http://upload-images.jianshu.io/upload_images/698554-9d1661ee627dc3ca.GIF?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### åŸºæœ¬æ€è·¯

é¦–å…ˆï¼Œè¡¨æƒ…åŒ…çš„å›¾ç‰‡æ˜¯ç”¨bundleçš„å½¢å¼ç»„ç»‡çš„ï¼Œç”¨`PPSticker`ç±»è¡¨å¾ä¸€å¥—è¡¨æƒ…åŒ…ï¼Œç”¨`PPEmoji`ç±»è¡¨å¾æŸä¸€ä¸ªè¡¨æƒ…ï¼Œç”¨ä¸€ä¸ªplistä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨è¡¨æƒ…åŒ…çš„ä¿¡æ¯ã€‚
![è¡¨æƒ…çš„ç»„ç»‡.jpg](http://upload-images.jianshu.io/upload_images/698554-10847f03391e9560.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

`PPStickerDataManager`ç±»ä¸»è¦è´Ÿè´£æ•°æ®éƒ¨åˆ†ï¼Œç”¨å•ä¾‹çš„å½¢å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™åªä¼šè¯»å–ä¸€æ¬¡plistæ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡¨æƒ…ä¿¡æ¯ï¼›åŒæ—¶æˆ‘ä»¬æŠŠè¾“å…¥æ¡†å†…å®¹å‘åˆ°æœåŠ¡ç«¯ä»¥åŠä»æœåŠ¡ç«¯è¯·æ±‚åˆ°çš„éƒ½æ˜¯çº¯æ–‡æœ¬çš„ï¼Œæ¯”å¦‚ä¼šæŠŠ "ç¬‘æ­»äº†ğŸ¤£" è½¬æˆ "ç¬‘æ­»äº†[ç¬‘å“­]" è¿™æ ·çš„çº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠè¡¨æƒ…å›¾ç‰‡ç›´æ¥å‘åˆ°æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´é¡¹ç›®ä¸­æœ‰å¤§é‡çš„åœ°æ–¹ä¼šæœ‰æŠŠæ–‡æœ¬->è¡¨æƒ…çš„æ“ä½œï¼Œæ‰€ä»¥`PPStickerDataManager`ç±»ä¹Ÿæä¾›åŒ¹é…æŸæ®µçº¯æ–‡æœ¬ä¸­çš„è¡¨æƒ…ï¼Œå¹¶æŠŠæ–‡æœ¬æ›¿æ¢ä¸ºå›¾ç‰‡çš„åŠŸèƒ½ï¼Œ`PPStickerDataManager`ç±»çš„å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š

```objective-c
@interface PPStickerDataManager : NSObject

+ (instancetype)sharedInstance;

/// æ‰€æœ‰çš„è¡¨æƒ…åŒ…
@property (nonatomic, strong, readonly) NSArray<PPSticker *> *allStickers;

/* åŒ¹é…ç»™å®šattributedStringä¸­çš„æ‰€æœ‰emojiï¼Œå¦‚æœåŒ¹é…åˆ°çš„emojiæœ‰æœ¬åœ°å›¾ç‰‡çš„è¯ä¼šç›´æ¥æ¢æˆæœ¬åœ°çš„å›¾ç‰‡
 *
 * @param attributedString å¯èƒ½åŒ…å«è¡¨æƒ…åŒ…çš„attributedString
 * @param font è¡¨æƒ…å›¾ç‰‡çš„å¯¹é½å­—ä½“å¤§å°
 */
- (void)replaceEmojiForAttributedString:(NSMutableAttributedString *)attributedString font:(UIFont *)font;

@end
```

#### "çœŸæ­£çš„"é”®ç›˜

çœŸæ­£çš„é”®ç›˜ä¹Ÿå°±æ˜¯è¯´è°ƒèµ·è¡¨æƒ…é”®ç›˜æ—¶è¾“å…¥æ¡†æ˜¯æœ‰å…‰æ ‡çš„ï¼Œèƒ½è¿›è¡Œæ‹–æ‹½å…‰æ ‡ã€é€‰ä¸­åŒºåŸŸç­‰çš„æ“ä½œï¼Œè¿™æ ·çš„ä½“éªŒæ‰æ˜¯ä¸ç³»ç»Ÿé”®ç›˜ä¸€è‡´çš„ã€‚å…¶å®ç³»ç»Ÿå·²ç»æä¾›å¥½äº†æ¥å£ç»™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼Œ`UITextView`å’Œ`UITextField`éƒ½æœ‰çš„`inputView`å’Œ`inputAccessoryView`å°±æ˜¯ç”¨æ¥å®ç°è‡ªå®šä¹‰é”®ç›˜çš„ï¼Œè¿™ä¸¤ä¸ªå±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š

```objective-c
// Presented when object becomes first responder.  If set to nil, reverts to following responder chain.  If
// set while first responder, will not take effect until reloadInputViews is called.
@property (nullable, readwrite, strong) UIView *inputView;             
@property (nullable, readwrite, strong) UIView *inputAccessoryView;
```

åŒæ—¶ç³»ç»Ÿé”®ç›˜åœ¨ è®¾ç½®->å£°éŸ³->æŒ‰é”®éŸ³ é€‰é¡¹æ‰“å¼€ä¸”æ‰‹æœºéé™éŸ³çŠ¶æ€ä¸‹è¾“å…¥æ˜¯æœ‰æŒ‰é”®çš„å£°éŸ³çš„ï¼Œè¿™ä¸ªæŒ‰é”®éŸ³ä¹Ÿæ˜¯å¯ä»¥æ”¯æŒçš„ï¼Œåªè¦è‡ªå®šä¹‰é”®ç›˜ç±»éµå¾ª`UIInputViewAudioFeedback`åè®®ï¼ŒåŒæ—¶å®ç° `enableInputClicksWhenVisible`æ–¹æ³•å¹¶è¿”å›YESï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç‚¹å‡»è¡¨æƒ…çš„æ—¶å€™è°ƒç”¨`[[UIDevice currentDevice] playInputClick]`æ–¹æ³•å‘å‡ºæŒ‰é”®éŸ³äº†ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹[è‹¹æœçš„å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/InputViews/InputViews.html)ã€‚

ä¸‹é¢æ˜¯Demoä¸­é”®ç›˜åˆ‡æ¢æ–¹æ³•çš„å®ç°ï¼š

```objective-c
- (void)changeKeyboardTo:(PPKeyboardType)toType
{
    switch (toType) {
        case PPKeyboardTypeSystem:
            self.textView.inputView = nil;    // åˆ‡æ¢åˆ°ç³»ç»Ÿé”®ç›˜
            [self.textView reloadInputViews]; // è°ƒç”¨reloadInputViewsæ–¹æ³•ä¼šç«‹åˆ»è¿›è¡Œé”®ç›˜çš„åˆ‡æ¢
            break;
        case PPKeyboardTypeSticker:            
            self.textView.inputView = self.stickerKeyboard; // åˆ‡æ¢åˆ°è‡ªå®šä¹‰çš„è¡¨æƒ…é”®ç›˜
            [self.textView reloadInputViews];
            break;
        default:
            break;
    }
}
```

#### å»é™¤è¡¨æƒ…çš„æ‹–æ‹½äº¤äº’

åœ¨iOS11ä¸Šï¼Œ`UITextView`ä¸Šçš„`NSTextAttachment`ï¼ˆè¡¨æƒ…ï¼‰é»˜è®¤å¯ä»¥è¿›è¡Œæ‹–æ‹½äº¤äº’ï¼Œä½†æ˜¯å´å¯¼è‡´æ‹–åŠ¨å…‰æ ‡æ—¶å¾ˆå®¹æ˜“è§¦å‘è¿™ä¸ªäº¤äº’ï¼ˆå›¾ç¤ºå¯ä»¥æŸ¥çœ‹ä¸Šé¢è¯´åˆ°çš„å¾®åšå›½é™…ç‰ˆä¸­çš„è¯¯è§¦ï¼‰ã€‚ä¸€ç•ªæŸ¥æ‰¾ä¹‹åæ‰æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒéšè”½çš„å±æ€§ï¼š`textDragInteraction`ï¼Œç›´æ¥è®¾ç½®ä¸º`NO`å°±èƒ½ç¦æ­¢æ‰`NSTextAttachment`çš„æ‹–æ‹½äº¤äº’ã€‚

```objective-c
if (@available(iOS 11.0, *)) {	// åªåœ¨iOS11åŠä»¥ä¸Šæ‰æœ‰è¿™ä¸ªå±æ€§
     _textView.textDragInteraction.enabled = NO;
}
```

#### ä¸æœåŠ¡ç«¯çš„äº¤äº’

æˆ‘ä»¬åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥çš„å†…å®¹ä¸æœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„æ—¶å€™éƒ½æ˜¯ç”¨çº¯æ–‡æœ¬çš„ï¼Œæ¯”å¦‚ä¼šæŠŠ "ç¬‘æ­»äº†ğŸ¤£" è½¬æˆ "ç¬‘æ­»äº†[ç¬‘å“­]" è¿™æ ·çš„çº¯æ–‡æœ¬å‘åˆ°æœåŠ¡ç«¯ï¼Œè€Œä¸æ˜¯ç›´æ¥å‘è¡¨æƒ…å›¾ç‰‡ï¼Œå‘æœåŠ¡ç«¯è¯·æ±‚å†…å®¹çš„æ—¶å€™ä¹Ÿæ˜¯ä¼ å› "ç¬‘æ­»äº†[ç¬‘å“­]"ï¼Œç„¶åå®¢æˆ·ç«¯å†æ ¹æ®æ­£åˆ™åŒ¹é…æ‰¾å‡ºè¡¨æƒ…æ›¿æ¢æˆå¯¹åº”çš„è¡¨æƒ…å›¾ç‰‡ï¼Œç„¶åæ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹å›¾ï¼š
![ä¸æœåŠ¡ç«¯çš„äº¤äº’.png](http://upload-images.jianshu.io/upload_images/698554-00199a31ec46945d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¾ç½®åˆ°è¾“å…¥æ¡†çš„`NSAttributedString`ä¸­çš„æ¯ä¸€ä¸ª`NSTextAttachment`éƒ½æœ‰ä¸€ä¸ª"éšè—çš„"å±æ€§â€”è¡¨æƒ…çš„æ–‡æœ¬æè¿°ï¼Œè¿™é‡Œå¯¹`NSAttributedString`è¿›è¡Œæ‹“å±•å°±èƒ½å®ç°ã€‚`pp_setTextBackedString`å¯ä»¥å¯¹`NSAttributedString`çš„æŒ‡å®š`range`è®¾ç½®ä¸€ä¸ª`PPTextBackedString`ç±»å‹çš„å±æ€§ï¼Œè€Œ`pp_plainTextForRange`èƒ½æ‹¿åˆ°`NSAttributedString`æŒ‡å®š`range`çš„çº¯æ–‡æœ¬ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```objective-c
@implementation NSAttributedString (PPAddition)

- (NSString *)pp_plainTextForRange:(NSRange)range
{
    if (range.location == NSNotFound || range.length == NSNotFound) {
        return nil;
    }

    NSMutableString *result = [[NSMutableString alloc] init];
    if (range.length == 0) {
        return result;
    }

    NSString *string = self.string;
    [self enumerateAttribute:PPTextBackedStringAttributeName inRange:range options:kNilOptions usingBlock:^(id value, NSRange range, BOOL *stop) {
        PPTextBackedString *backed = value;
        if (backed && backed.string) {
            [result appendString:backed.string];
        } else {
            [result appendString:[string substringWithRange:range]];
        }
    }];
    return result;
}

@end

@implementation NSMutableAttributedString (PPAddition)

- (void)pp_setTextBackedString:(PPTextBackedString *)textBackedString range:(NSRange)range
{
    if (textBackedString && ![NSNull isEqual:textBackedString]) {
        [self addAttribute:PPTextBackedStringAttributeName value:textBackedString range:range];
    } else {
        [self removeAttribute:PPTextBackedStringAttributeName range:range];
    }
}

@end
```

#### çµæ´»çš„å…‰æ ‡

è¡¨æƒ…åŠŸèƒ½ï¼Œ`UITextView`éƒ½æ˜¯ç”¨`NSAttributedString`è¿›è¡Œèµ‹å€¼çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åº•å±‚å…¶å®è¿˜æ˜¯ç”¨ä¸Šé¢è¯´åˆ°çš„çº¯æ–‡æœ¬è¿›è¡Œå®ç°çš„ï¼Œé‚£ä¹ˆæŠŠ [ç¬‘æ­»] è½¬æˆ ğŸ¤£ å°±ä¼šä»4ä¸ªå­—ç¬¦å˜æˆ1ä¸ªå­—ç¬¦ï¼Œè¿™é‡Œæ˜¯æœ‰å·®å€¼çš„ï¼Œå¦‚æœä¸å¤„ç†çš„è¯å°±ä¼šå‡ºç°ä¸Šé¢æåˆ°çš„å¾®åšå›½é™…ç‰ˆä¸­å¤åˆ¶é»è´´è¾“å…¥æ¡†çš„è¡¨æƒ…ä¼šå¯¼è‡´å…‰æ ‡ä½ç½®ä¸å¯¹ï¼Œç”šè‡³è«åå…¶å¦™å¤šå‡ºå‰åç©ºæ ¼çš„é—®é¢˜ã€‚ä¸ºäº†ç²¾å‡†çš„å®šä½å…‰æ ‡ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œå¤„ç†å¥½è¿™äº›é—®é¢˜ã€‚

è¿™é‡Œè‡ªå·±ç»§æ‰¿å¹¶å®ç°äº†`UITextView`çš„å­ç±»`PPStickerTextView`ï¼Œåœ¨è¿™ä¸ªç±»ä¸­é‡è½½å¤åˆ¶ã€é»è´´ã€å‰ªåˆ‡ç­‰æ“ä½œï¼Œåˆ†åˆ«å¯¹åº”çš„æ–¹æ³•å¦‚ä¸‹ï¼š

```objective-c
- (void)cut:(id)sender;		// å‰ªåˆ‡

- (void)copy:(id)sender;	// å¤åˆ¶

- (void)paste:(id)sender;	// é»è´´
```

ä¸‹é¢ä»¥å‰ªåˆ‡æ–¹æ³•ä¸¾ä¾‹ï¼Œçœ‹çœ‹æ€ä¹ˆå¤„ç†å…‰æ ‡çš„é—®é¢˜ï¼Œéœ€è¦æ³¨æ„çš„åœ°æ–¹è¯·çœ‹å¯¹åº”çš„æ³¨é‡Šï¼š

```objective-c
- (void)cut:(id)sender
{
    // 1.ä»textViewä¸­æ‹¿åˆ°å¯¹åº”çš„çº¯æ–‡æœ¬ï¼Œæ¯”å¦‚ï¼šç¬‘æ­»äº†[ç¬‘æ­»]
    NSString *string = [self.attributedText pp_plainTextForRange:self.selectedRange];
    if (string.length) {
      	// 2. å°†çº¯æ–‡æœ¬å†™å…¥åˆ°å‰ªè´´æ¿ä¸­
        [UIPasteboard generalPasteboard].string = string;

      	// 3. è®°ä½å½“å‰çš„å…‰æ ‡ä½ç½®
        NSRange selectedRange = self.selectedRange;
        NSMutableAttributedString *attributeContent = [[NSMutableAttributedString alloc] initWithAttributedString:self.attributedText];
      	// 4. å°†æ£€æµ‹åˆ°æ˜¯è¡¨æƒ…çš„æ–‡æœ¬æ›¿æ¢æˆå¯¹åº”çš„å›¾ç‰‡
        [attributeContent replaceCharactersInRange:self.selectedRange withString:@""];
        self.attributedText = attributeContent;
      
      	// 5. é‡æ–°è®¾ç½®å…‰æ ‡
        self.selectedRange = NSMakeRange(selectedRange.location, 0);
    }
}
```

æŠ€æœ¯ç‚¹çš„åˆ†æå°±æ˜¯ä»¥ä¸Šè¿™äº›ï¼Œè¯¦ç»†çš„ä»£ç å¯ä»¥cloneä»£ç æŸ¥çœ‹ï¼šhttps://github.com/VernonVan/PPStickerKeyboard